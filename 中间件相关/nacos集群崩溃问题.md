21年9月公司dubbo升级，将注册中心从zk改为nacos，版本1.4.1，由于对nacos的不了解，最终造成线上3小时瘫痪的事故。

![image-20240531111443511](C:\Users\Dell\AppData\Roaming\Typora\typora-user-images\image-20240531111443511.png)

![image-20240531111513606](C:\Users\Dell\AppData\Roaming\Typora\typora-user-images\image-20240531111513606.png)



问题第一时间是从客户反馈过来的，然后到研发这里，首先是查询服务日志，发现连接nacos有问题，于是紧急拉了一个群，参与处理的包括各个项目组的老大，以及架构师，还有运维。

由于线上问题比较紧急，大家的第一反应不是细究问题，而是看能不能通过升级cpu和内存恢复

![image-20240531111817957](C:\Users\Dell\AppData\Roaming\Typora\typora-user-images\image-20240531111817957.png)

这个过程也挺花时间的，搞完已经10点36，但是问题仍然没有解决，这时候技术总监拉了一个外援进来，据说很牛逼

![image-20240531112237535](C:\Users\Dell\AppData\Roaming\Typora\typora-user-images\image-20240531112237535.png)

![image-20240531112355406](C:\Users\Dell\AppData\Roaming\Typora\typora-user-images\image-20240531112355406.png)

这个阶段一直开着语音，外援先是问了下情况，然后询问配置相关的东西，也让我们做出一定的操作去测试是否能够恢复，这里主要是我来操作，同时其他同事应该也在努力找到问题。

这个过程发生了一点小插曲，由于外援一直通过我来操作，整个过程，我是完全照着他的意思来操作，也就是说我能理解他的思路，他的想法，他接下来的意图是什么。

那外援让我操作的事情，我们在之前已经操作过了，我把这情况说出来，外援似乎没听到，仍然让我那么操作，他想要的操作就是将nacos的配置文件还原，之前我们已经试过了，没有效果，并且现在最大的问题是nacos登陆界面都进不去，他还试图让我们进去查看状态。

时间走到11点30，技术总监觉得让外援语音指导发挥有限，所以想让外援远程我的电脑进行操作，最终没有远程成功，我也没有继续再按照外援的指示操作。当然这个时候技术总监还在跟外援通话，并且吐槽我们有一位员工挺不谦虚的，就是我，因为我在他的指示过程中多次否定他的操作。



接下来半个小时内，我改变策略，不再追寻集群的稳定性，将集群缩成一台单机，问题得到临时解决

![image-20240531113758925](C:\Users\Dell\AppData\Roaming\Typora\typora-user-images\image-20240531113758925.png)

整个故障持续时间3小时，持续时间内所有业务崩溃。

后面针对这次故障去测试环境进行模拟测试，但是没有再次触发，我们针对这次故障的临时恢复手法做了改进优化制定了最终方案。

方案不在此描述。

此次故障之后，一两年之后又出现了一次完全一样的故障，当时nacos的版本已经升到了1.4.2，那次故障的恢复时间只用了几分钟。